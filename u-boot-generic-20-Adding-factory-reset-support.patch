From 334084809f79b4f9a2832bdc6cef4724809141b4 Mon Sep 17 00:00:00 2001
From: Ondrej Kubik <ondrej.kubik@canonical.com>
Date: Wed, 17 Jan 2018 11:44:27 +0000
Subject: [PATCH 1/1] Adding factory reset support

Signed-off-by: Ondrej Kubik <ondrej.kubik@canonical.com>
---
 include/configs/dragonboard410c.h | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/include/configs/dragonboard410c.h b/include/configs/dragonboard410c.h
index fc33f70..6b0fb68 100644
--- a/include/configs/dragonboard410c.h
+++ b/include/configs/dragonboard410c.h
@@ -181,14 +181,15 @@
                       "elif test \"${snap_mode}\" = \"trying\"; " \
                           "then setenv snap_mode \"\"; saveenv; " \
                       "fi; " \
-                  "run loadfiles; setenv mmcroot \"/dev/disk/by-label/writable ${snappy_cmdline} snap_core=${snap_core} snap_kernel=${snap_kernel}\"; " \
+                  "if test \"${reset}\" = \"factory-reset\"; then setenv factory_reset \"factory-reset\"; else setenv factory_reset \"\"; fi; " \
+                  "run loadfiles; setenv mmcroot \"/dev/disk/by-label/writable ${snappy_cmdline} snap_core=${snap_core} snap_kernel=${snap_kernel} ${factory_reset}\"; " \
                   "run mmcargs; bootm ${linux_itb_addr}#config@1\0" \
       "snappy_cmdline=net.ifnames=0 init=/lib/systemd/systemd ro rng_core.default_quality=700 panic=-1 fixrtc\0" \
       "fdt_high=0xffffffffffffffff\0" \
       "initrd_high=0xffffffffffffffff\0" \
       BOOTENV
 
-#define CONFIG_ENV_WHITELIST  "snap_mode","snap_core","snap_try_core","snap_kernel","snap_try_kernel", "load_device", NULL
+#define CONFIG_ENV_WHITELIST  "snap_mode","snap_core","snap_try_core","snap_kernel","snap_try_kernel", "load_device", "reset", NULL
 #undef CONFIG_ENV_IS_NOWHERE
 #define CONFIG_ENV_SIZE		SZ_128K
 #define CONFIG_ENV_IS_IN_FAT
-- 
2.7.4

